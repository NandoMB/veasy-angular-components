"use strict";angular.module("veasy.calendar").factory("vCalendarService",function(){var r=function(t,e,a){for(var r=[],n=t.clone().startOf("month"),o=1;o<=6;)r.push(d(n,e,a)),o++;return r},d=function(t,e,a){var r=[];t.day(0);for(var n=t.day();r.push(o(t.clone(),e,a)),t.add(1,"days"),++n<7;);return r},o=function(t,e,a){return{date:t,day:t.format("DD"),month:t.format("MM"),year:t.format("YYYY"),events:n(t,e),isCurrentMonth:t.month()===a,isWeekend:0===t.day()||6===t.day(),isToday:t.isSame(moment().startOf("day"))}},n=function(t,e){var a=t.year(),r=t.month(),n=t.date();return e[a]&&e[a][r]?(e[a][r][n]||[]).sort(function(t,e){return moment(t.date).isSameOrBefore(e.date)?-1:1}):[]};return{buildCalendar:function(t,e){var a=t.date||moment().startOf("day");return{date:a,title:a.format("MMMM YYYY"),year:a.year(),month:a.month(),weekDays:moment.weekdaysShort(),weeks:r(a,e,a.clone().month()),events:e}},catalogEvents:function(t){var e={},a=!0,r=!1,n=void 0;try{for(var o,d=t[Symbol.iterator]();!(a=(o=d.next()).done);a=!0){var m=o.value,u=moment(m.date).year(),f=moment(m.date).month(),y=moment(m.date).date();e[u]=e[u]||{},e[u][f]=e[u][f]||{},e[u][f][y]=e[u][f][y]||[],e[u][f][y].push(m)}}catch(t){r=!0,n=t}finally{try{a||null==d.return||d.return()}finally{if(r)throw n}}return e}}});
"use strict";angular.module("veasy.calendar").directive("vCalendar",["vCalendarService",function(i){return{restrict:"E",replace:!0,templateUrl:"veasy-calendar.html",scope:{config:"="},link:function(a,e,n,t){var o=i.catalogEvents(a.config.events);a.previousMonth=function(){a.$emit("veasyCalendar:onClickPreviousMonthStart"),a.config.date=a.calendar.date.subtract(1,"month"),a.calendar=i.buildCalendar(a.config,o),a.$emit("veasyCalendar:onClickPreviousMonthEnd")},a.nextMonth=function(){a.$emit("veasyCalendar:onClickNextMonthStart"),a.config.date=a.calendar.date.add(1,"month"),a.calendar=i.buildCalendar(a.config,o),a.$emit("veasyCalendar:onClickNextMonthEnd")},a.$on("veasyCalendar:addNewEvent",function(e,n){a.openedEvent={},d("event-modal",{keyboard:!0,backdrop:!0})}),a.onClickDay=function(e){a.$emit("veasyCalendar:onClickDay",{message:JSON.stringify(e)}),a.openedEvent={},d("event-modal",{keyboard:!0,backdrop:!0})},a.onClickEvent=function(e,n){e.stopPropagation(),a.$emit("veasyCalendar:onClickEvent",{message:JSON.stringify(n)}),a.openedEvent=angular.copy(n),d("event-modal",{keyboard:!0,backdrop:!0})},a.onSaveEvent=function(e){a.$emit("veasyCalendar:onSaveEvent",{message:JSON.stringify(e)}),a.openedEvent={},r("event-modal")};var d=function(e,n){angular.element("#"+e).modal({keyboard:n.keyboard,backdrop:n.backdrop})},r=function(e){angular.element("#"+e).modal("hide"),a.openedEvent={}};a.openedEvent={},a.calendar=i.buildCalendar(a.config,o)}}}]);