"use strict";function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(e){_defineProperty(t,e,n[e])})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}angular.module("veasy.calendar").factory("calendarService",function(){var r=function(e){return e.format("MMMM YYYY")},a=function(e){var t=e.clone().startOf("week"),n=e.clone().endOf("week");return t.format("MMMM YYYY")===n.format("MMMM YYYY")?t.format("MMMM YYYY"):t.year()===n.year()?t.format("MMM")+" - "+n.format("MMM YYYY"):t.format("MMM YYYY")+" - "+n.format("MMM YYYY")},o=function(e,t,n,r){for(var a=t.clone().startOf("month"),o=[],i=1;i<=6;i++)o.push(c(e,a.clone(),n,r)),a.add(1,"weeks");return o},c=function(e,t,n,r){var a=[];t.day(0);for(var o=t.day();o<7;o++)a.push(i(e,t.clone(),n,r)),t.add(1,"days");return a},i=function(e,t,n,r){var a={date:t,year:t.format("YYYY"),month:t.format("MM"),day:t.format("DD"),isCurrentMonth:t.month()===r,isWeekend:0===t.day()||6===t.day(),isToday:t.startOf("day").isSame(moment().startOf("day"))};return"month"===e.viewMode?_objectSpread({},a,{events:u(t,n)}):"week"===e.viewMode?_objectSpread({},a,{multiDayEvents:f(e,n,t.year(),t.month(),t.date()),timeslots:d(e,t,n)}):void 0},u=function(e,t){var n=e.year(),r=e.month(),a=e.date();return t[n]&&t[n][r]?(t[n][r][a]||[]).sort(function(e,t){return moment(e.date).isSameOrBefore(t.date)?1:-1}):[]},f=function(e,t,n,r,a){return Object.keys(t).length?(t[n]=t[n]||{},t[n][r]=t[n][r]||{},t[n][r][a]=t[n][r][a]||{},t[n][r][a].multiDayEvents||[]):[]},d=function(e,t,n){for(var r=angular.copy(e.timeslots),a=0;a<e.timeslots.length;a++)r[a].events=l(t,r[a].time,n);return r},l=function(e,t,n){var r=e.year(),a=e.month(),o=e.date();return n[r]&&n[r][a]&&n[r][a][o]?(n[r][a][o][t]||[]).sort(function(e,t){return moment(e.date).isSameOrBefore(t.date)?1:-1}):[]};return{buildCalendar:function(e,t){e.viewMode=e.viewMode||"month";var n={viewMode:e.viewMode,initialDate:e.initialDate,weekDays:moment.weekdaysShort()};return"month"===e.viewMode?_objectSpread({},n,{title:r(e.initialDate),weeks:o(e,e.initialDate.clone(),t,e.initialDate.clone().month())}):"week"===e.viewMode?_objectSpread({},n,{title:a(e.initialDate),week:c(e,e.initialDate.clone(),t,e.initialDate.clone().month())}):void 0}}});
"use strict";function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(e){_defineProperty(t,e,r[e])})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}angular.module("veasy.calendar").factory("catalogService",function(){var l=function(){var e=Math.floor(256*Math.random()),t=Math.floor(256*Math.random()),r=Math.floor(256*Math.random()),n="#FFF";return 140<(299*e+587*t+114*r)/1e3&&(n="#333"),{background:"rgb(".concat(e,", ").concat(t,", ").concat(r,")"),text:n}},f=function(e,t,r,n,a,o){if(e[r]=e[r]||{},e[r][n]=e[r][n]||{},"month"===t)e[r][n][a]=e[r][n][a]||[];else if("week"===t&&(e[r][n][a]=e[r][n][a]||{},e[r][n][a].multiDayEvents=e[r][n][a].multiDayEvents||[],o))for(var i=0;i<o.length;i++){var u=o[i].time;e[r][n][a][u]=e[r][n][a][u]||[]}return e},d=function(e){return e.startDate.isSameOrBefore(e.endDate)},m=function(e){return!e.startDate.isSame(e.endDate,"day")},y=function(e,t){for(var r=t.startDate.clone();e[r.year()]=e[r.year()]||{},e[r.year()][r.month()]=e[r.year()][r.month()]||{},e[r.year()][r.month()][r.date()]=e[r.year()][r.month()][r.date()]||[],e[r.year()][r.month()][r.date()].push(t),r.add(1,"days"),r.isSameOrBefore(t.endDate););return e},v=function(e,t,r,n,a,o){for(var i=Math.ceil(r.endDate.diff(r.startDate,"hours")/24),u=0,c=r.startDate.clone(),s=e.initialDate.clone().startOf("week"),l=e.initialDate.clone().endOf("week");r=_objectSpread({},r,{chunk:u,payload:i,isCurrentWeek:c.isBetween(s,l,null,"[]")}),t=D(t,r,c.year(),c.month(),c.date()),c.add(1,"days"),u++,c.isSameOrBefore(r.endDate););return t},h=function(e,t,r,n,a,o){var i=o.find(function(e){return t.startDate.hour()===u(e)}).time;return e[r][n][a][i].push(t),e},u=function(e){return parseInt(e.time.substr(0,2))},D=function(e,t,r,n,a){return e[r]=e[r]||{},e[r][n]=e[r][n]||{},e[r][n][a]=e[r][n][a]||{},e[r][n][a].multiDayEvents=e[r][n][a].multiDayEvents||[],e[r][n][a].multiDayEvents.push(t),e};return{catalogEvents:function(e){var t=e.fields.find(function(e){return e.isEventOrigin}).property,r={},n=!0,a=!1,o=void 0;try{for(var i,u=e.events[Symbol.iterator]();!(n=(i=u.next()).done);n=!0){var c=i.value;c.veasyId=JSON.stringify(c),c.colors=c.colors||{},e.randomEventsColors&&(c.colors=l());var s=moment(c[t]);c.startDate=moment(c.startDate),c.endDate=moment(c.endDate),r=f(r,e.viewMode,s.year(),s.month(),s.date(),e.timeslots),d(c)&&("month"===e.viewMode?r=y(r,c):"week"===e.viewMode&&(r=m(c)?(c.isMultiDayEvent=!0,v(e,r,c,s.year(),s.month(),s.date())):h(r,c,s.year(),s.month(),s.date(),e.timeslots)))}}catch(e){a=!0,o=e}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}return r}}});
"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}angular.module("veasy.calendar").directive("vCalendar",["$timeout","$filter","catalogService","calendarService",function(e,m,f,d){return{restrict:"E",replace:!0,templateUrl:"veasy-calendar.html",scope:{config:"<"},link:function(u,e,t,n){var o,i=function(){return[{time:"00:00",show:!1},{time:"01:00",show:!0},{time:"02:00",show:!0},{time:"03:00",show:!0},{time:"04:00",show:!0},{time:"05:00",show:!0},{time:"06:00",show:!0},{time:"07:00",show:!0},{time:"08:00",show:!0},{time:"09:00",show:!0},{time:"10:00",show:!0},{time:"11:00",show:!0},{time:"12:00",show:!0},{time:"13:00",show:!0},{time:"14:00",show:!0},{time:"15:00",show:!0},{time:"16:00",show:!0},{time:"17:00",show:!0},{time:"18:00",show:!0},{time:"19:00",show:!0},{time:"20:00",show:!0},{time:"21:00",show:!0},{time:"22:00",show:!0},{time:"23:00",show:!0}]},a=function(){u.$watchCollection("config.events",function(e,t){e.length&&(u.config.events=m("orderBy")(e,"startDate",!1),o=f.catalogEvents(u.config,e),r(u.config,o))})},r=function(e,t){u.calendar=d.buildCalendar(e,t),"week"===u.viewMode&&(u.weeklyEventsLines=c(u.calendar,t))};u.onClickDay=function(e,t){var n=t?t.time.split(":")[0]:0,o=t?t.time.split(":")[1]:0,i=e.date.clone().hour(n).minute(o);u.$emit("veasycalendar:onClickDay",i)},u.onClickEvent=function(e,t){e.stopPropagation();var n=angular.copy(t);n.$$hashKey&&delete n.$$hashKey,n.veasyId&&delete n.veasyId,n.colors&&delete n.colors,u.$emit("veasycalendar:onClickEvent",n)},u.onClickToday=function(){u.config.initialDate=moment(),r(u.config,o)},u.onChangeViewMode=function(e){u.config.viewMode=e,u.viewMode=e,u.config.initialDate=moment(),o=f.catalogEvents(u.config,u.config.events),r(u.config,o),u.$emit("veasycalendar:onChangeViewMode")},u.onPreviousMonth=function(){u.$emit("veasycalendar:onClickPreviousMonthStart"),u.config.initialDate=u.calendar.initialDate.subtract(1,"month"),r(u.config,o),u.$emit("veasycalendar:onClickPreviousMonthEnd")},u.onNextMonth=function(){u.$emit("veasycalendar:onClickNextMonthStart"),u.config.initialDate=u.calendar.initialDate.add(1,"month"),r(u.config,o),u.$emit("veasycalendar:onClickNextMonthEnd")},u.onPreviousWeek=function(){u.$emit("veasycalendar:onClickPreviousWeekStart"),u.config.initialDate=u.calendar.initialDate.subtract(1,"week"),r(u.config,o),u.$emit("veasycalendar:onClickPreviousWeekEnd")},u.onNextWeek=function(){u.$emit("veasycalendar:onClickNextWeekStart"),u.config.initialDate=u.calendar.initialDate.add(1,"week"),r(u.config,o),u.$emit("veasycalendar:onClickNextWeekEnd")};var l=function(){for(var e=[],t=0;t<7;t++)e.push({isEmpty:!0});return e},s=function(e,t){return e.reduce(function(e,t){return e.concat(t)},[]).some(function(e){return e.veasyId===t})},c=function(e){for(var t=function(e){for(var t=Math.max.apply(Math,_toConsumableArray(e.week.map(function(e){return e.multiDayEvents.length}))),n=[],o=0;o<t;o++)n.push(l());return n}(e),n=0;n<e.week.length;n++)for(var o=e.week[n],i=0;i<o.multiDayEvents.length;i++)for(var a=o.multiDayEvents[i],r=0;r<t.length;r++)if(t[r][n].isEmpty){if(s(t,a.veasyId))break;t[r][n]=a;for(var c=1;c<a.payload-a.chunk;c++)t[r][n+c]&&(t[r][n+c].isEmpty=!1);break}return t};u.getMonthlyEventStyle=function(e){return{color:e.colors.text,"background-color":e.colors.background,"border-color":e.colors.background}},u.getWeeklyEventStyle=function(e){var t=e.chunk,n=e.payload,o=n,i=moment(e.startDate).day();return 0<t&&(i=moment(e.startDate).add(t,"days").day()),0<t&&(e.isLeftArrow=!0,o=n-t),7<i+n-t&&(e.isRightArrow=!0,o=7-i),7<n+i&&1,{position:"absolute",left:"".concat(2,"px"),width:"calc(100% * ".concat(o," + ").concat(o-1,"px - ").concat(4,"px)"),color:e.colors.text,"background-color":e.colors.background,"border-color":e.colors.background,"z-index":2}},u.getEventStyle=function(e,t,n,o){var i=o.length||1,a="".concat(100/i,"%"),r=moment.duration(moment(e.endDate).diff(moment(e.startDate))),c=5*(Math.ceil(r.asMinutes()/60)-1),l=moment(e.endDate).diff(moment(e.startDate),"minutes"),s="".concat(t," * ").concat(a);return{position:"absolute",left:"calc(".concat(s,")"),top:!!u.config.organizeEventBasedOnTime&&"".concat(100*e.startDate.minutes()/60,"%"),width:"calc(100% - (".concat(s,"))"),height:"calc(".concat(l/60*100,"% + ").concat(c,"px)"),"min-height":"17px",color:e.colors.text,"background-color":e.colors.background}},u.getEventTitle=function(){return(u.config.fields.find(function(e){return e.isEventTitle})||{}).property||"..."},u.getFieldsEventBody=function(){return u.config.fields.filter(function(e){return e.isEventBody}).map(function(e){return e.property})},u.getEventTime=function(e,t){return"".concat(moment(e).format("HH:mm")," - ").concat(moment(t).format("HH:mm"))},u.viewModes=["month","week"],u.viewMode=u.config.viewMode||u.viewModes[0],u.config.initialDate=u.config.initialDate?moment(u.config.initialDate).startOf("day"):moment().startOf("day"),u.config.timeslots=i(),u.config.utcOffset=(u.config.utcOffset||"").replace(":",""),a()}}}]);