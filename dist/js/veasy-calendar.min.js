"use strict";function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(e){_defineProperty(t,e,n[e])})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}angular.module("veasy.calendar").factory("calendarService",function(){var r=function(e){return e.format("MMMM YYYY")},a=function(e){var t=e.clone().startOf("week"),n=e.clone().endOf("week");return t.format("MMMM YYYY")===n.format("MMMM YYYY")?t.format("MMMM YYYY"):t.year()===n.year()?t.format("MMM")+" - "+n.format("MMM YYYY"):t.format("MMM YYYY")+" - "+n.format("MMM YYYY")},o=function(e,t,n,r){for(var a=t.clone().startOf("month"),o=[],i=1;i<=6;i++)o.push(c(e,a.clone(),n,r)),a.add(1,"weeks");return o},c=function(e,t,n,r){var a=[];t.day(0);for(var o=t.day();o<7;o++)a.push(i(e,t.clone(),n,r)),t.add(1,"days");return a},i=function(e,t,n,r){var a={date:t,year:t.format("YYYY"),month:t.format("MM"),day:t.format("DD"),isCurrentMonth:t.month()===r,isWeekend:0===t.day()||6===t.day(),isToday:t.startOf("day").isSame(moment().startOf("day"))};return"month"===e.viewMode?_objectSpread({},a,{events:u(t,n)}):"week"===e.viewMode?_objectSpread({},a,{multiDayEvents:f(e,n,t.year(),t.month(),t.date()),timeslots:d(e,t,n)}):void 0},u=function(e,t){var n=e.year(),r=e.month(),a=e.date();return t[n]&&t[n][r]?(t[n][r][a]||[]).sort(function(e,t){return moment(e.date).isSameOrBefore(t.date)?1:-1}):[]},f=function(e,t,n,r,a){return Object.keys(t).length?(t[n]=t[n]||{},t[n][r]=t[n][r]||{},t[n][r][a]=t[n][r][a]||{},t[n][r][a].multiDayEvents||[]):[]},d=function(e,t,n){for(var r=angular.copy(e.timeslots),a=0;a<e.timeslots.length;a++)r[a].events=l(t,r[a].time,n);return r},l=function(e,t,n){var r=e.year(),a=e.month(),o=e.date();return n[r]&&n[r][a]&&n[r][a][o]?(n[r][a][o][t]||[]).sort(function(e,t){return moment(e.date).isSameOrBefore(t.date)?1:-1}):[]};return{buildCalendar:function(e,t){e.viewMode=e.viewMode||"month";var n={viewMode:e.viewMode,initialDate:e.initialDate,weekDays:moment.weekdaysShort()};return"month"===e.viewMode?_objectSpread({},n,{title:r(e.initialDate),weeks:o(e,e.initialDate.clone(),t,e.initialDate.clone().month())}):"week"===e.viewMode?_objectSpread({},n,{title:a(e.initialDate),week:c(e,e.initialDate.clone(),t,e.initialDate.clone().month())}):void 0}}});
"use strict";function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(e){_defineProperty(t,e,r[e])})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}angular.module("veasy.calendar").factory("catalogService",function(){var f=function(e,t,r,n,a,o){if(e[r]=e[r]||{},e[r][n]=e[r][n]||{},"month"===t)e[r][n][a]=e[r][n][a]||[];else if("week"===t&&(e[r][n][a]=e[r][n][a]||{},e[r][n][a].multiDayEvents=e[r][n][a].multiDayEvents||[],o))for(var i=0;i<o.length;i++){var u=o[i].time;e[r][n][a][u]=e[r][n][a][u]||[]}return e},s=function(e){return e.startDate.isSameOrBefore(e.endDate)},d=function(e){return!e.startDate.isSame(e.endDate,"day")},m=function(e,t){for(var r=t.startDate.clone();e[r.year()]=e[r.year()]||{},e[r.year()][r.month()]=e[r.year()][r.month()]||{},e[r.year()][r.month()][r.date()]=e[r.year()][r.month()][r.date()]||[],e[r.year()][r.month()][r.date()].push(t),r.add(1,"days"),r.isSameOrBefore(t.endDate););return e},y=function(e,t,r,n,a,o){for(var i=Math.ceil(r.endDate.diff(r.startDate,"hours")/24),u=0,c=r.startDate.clone(),l=e.initialDate.clone().startOf("week"),f=e.initialDate.clone().endOf("week");r=_objectSpread({},r,{chunk:u,payload:i,isCurrentWeek:c.isBetween(l,f,null,"[]")}),t=h(t,r,c.year(),c.month(),c.date()),c.add(1,"days"),u++,c.isSameOrBefore(r.endDate););return t},v=function(e,t,r,n,a,o){var i=o.find(function(e){return t.startDate.hour()===u(e)}).time;return e[r][n][a][i].push(t),e},u=function(e){return parseInt(e.time.substr(0,2))},h=function(e,t,r,n,a){return e[r]=e[r]||{},e[r][n]=e[r][n]||{},e[r][n][a]=e[r][n][a]||{},e[r][n][a].multiDayEvents=e[r][n][a].multiDayEvents||[],e[r][n][a].multiDayEvents.push(t),e};return{catalogEvents:function(e){var t=e.fields.find(function(e){return e.isEventOrigin}).property,r={},n=!0,a=!1,o=void 0;try{for(var i,u=e.events[Symbol.iterator]();!(n=(i=u.next()).done);n=!0){var c=i.value;c.id=btoa(JSON.stringify(c)),c.color=c.color||"",e.randomEventsColors&&(c.color="rgb(".concat(Math.floor(256*Math.random()),", ").concat(Math.floor(256*Math.random()),", ").concat(Math.floor(256*Math.random()),")"));var l=moment(c[t]);c.startDate=moment(c.startDate),c.endDate=moment(c.endDate),r=f(r,e.viewMode,l.year(),l.month(),l.date(),e.timeslots),s(c)&&("month"===e.viewMode?r=m(r,c):"week"===e.viewMode&&(r=d(c)?(c.isMultiDayEvent=!0,y(e,r,c,l.year(),l.month(),l.date())):v(r,c,l.year(),l.month(),l.date(),e.timeslots)))}}catch(e){a=!0,o=e}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}return r}}});
"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}angular.module("veasy.calendar").directive("vCalendar",["$timeout","$filter","catalogService","calendarService",function(t,f,u,d){return{restrict:"E",replace:!0,templateUrl:"veasy-calendar.html",scope:{config:"<"},link:function(a,t,e,n){var i,o=function(){return[{time:"00:00",show:!1},{time:"01:00",show:!0},{time:"02:00",show:!0},{time:"03:00",show:!0},{time:"04:00",show:!0},{time:"05:00",show:!0},{time:"06:00",show:!0},{time:"07:00",show:!0},{time:"08:00",show:!0},{time:"09:00",show:!0},{time:"10:00",show:!0},{time:"11:00",show:!0},{time:"12:00",show:!0},{time:"13:00",show:!0},{time:"14:00",show:!0},{time:"15:00",show:!0},{time:"16:00",show:!0},{time:"17:00",show:!0},{time:"18:00",show:!0},{time:"19:00",show:!0},{time:"20:00",show:!0},{time:"21:00",show:!0},{time:"22:00",show:!0},{time:"23:00",show:!0}]},r=function(){a.$watchCollection("config.events",function(t,e){t.length&&(a.config.events=f("orderBy")(t,"startDate",!1),i=u.catalogEvents(a.config,t),c(a.config,i))})},c=function(t,e){a.calendar=d.buildCalendar(t,e),"week"===a.viewMode&&(a.weeklyEventsLines=m(a.calendar,e))};a.onClickDay=function(t,e){var n=e?e.time.split(":")[0]:0,i=e?e.time.split(":")[1]:0,o=t.date.clone().hour(n).minute(i);a.$emit("veasycalendar:onClickDay",o)},a.onClickEvent=function(t,e){t.stopPropagation(),a.$emit("veasycalendar:onClickEvent",e)},a.onClickToday=function(){a.config.initialDate=moment(),c(a.config,i)},a.onChangeViewMode=function(t){a.config.viewMode=t,a.viewMode=t,a.config.initialDate=moment(),i=u.catalogEvents(a.config,a.config.events),c(a.config,i),a.$emit("veasycalendar:onChangeViewMode")},a.onPreviousMonth=function(){a.$emit("veasycalendar:onClickPreviousMonthStart"),a.config.initialDate=a.calendar.initialDate.subtract(1,"month"),c(a.config,i),a.$emit("veasycalendar:onClickPreviousMonthEnd")},a.onNextMonth=function(){a.$emit("veasycalendar:onClickNextMonthStart"),a.config.initialDate=a.calendar.initialDate.add(1,"month"),c(a.config,i),a.$emit("veasycalendar:onClickNextMonthEnd")},a.onPreviousWeek=function(){a.$emit("veasycalendar:onClickPreviousWeekStart"),a.config.initialDate=a.calendar.initialDate.subtract(1,"week"),c(a.config,i),a.$emit("veasycalendar:onClickPreviousWeekEnd")},a.onNextWeek=function(){a.$emit("veasycalendar:onClickNextWeekStart"),a.config.initialDate=a.calendar.initialDate.add(1,"week"),c(a.config,i),a.$emit("veasycalendar:onClickNextWeekEnd")};var l=function(){for(var t=[],e=0;e<7;e++)t.push({isEmpty:!0});return t},s=function(t,e){return t.reduce(function(t,e){return t.concat(e)},[]).some(function(t){return t.id===e})},m=function(t){for(var e=function(t){for(var e=Math.max.apply(Math,_toConsumableArray(t.week.map(function(t){return t.multiDayEvents.length}))),n=[],i=0;i<e;i++)n.push(l());return n}(t),n=0;n<t.week.length;n++)for(var i=t.week[n],o=0;o<i.multiDayEvents.length;o++)for(var a=i.multiDayEvents[o],r=0;r<e.length;r++)if(e[r][n].isEmpty){if(s(e,a.id))break;e[r][n]=a;for(var c=1;c<a.payload-a.chunk;c++)e[r][n+c]&&(e[r][n+c].isEmpty=!1);break}return e};a.getWeeklyEventStyle=function(t){var e=t.chunk,n=t.payload,i=n,o=moment(t.startDate).day();return 0<e&&(o=moment(t.startDate).add(e,"days").day()),0<e&&(t.isLeftArrow=!0,i=n-e),7<o+n-e&&(t.isRightArrow=!0,i=7-o),7<n+o&&1,{position:"absolute",left:"".concat(2,"px"),width:"calc(100% * ".concat(i," + ").concat(i-1,"px - ").concat(4,"px)"),"z-index":2}},a.getEventStyle=function(t,e,n,i){var o=i.length-1||1,a="".concat(100/o,"%"),r=moment.duration(moment(t.endDate).diff(moment(t.startDate))),c=Math.ceil(r.asMinutes()/60),l=5*(c-1);return{position:"absolute","background-color":t.color,width:"calc(100% - ".concat(4,"px - (").concat(o," * ").concat(a,"))"),height:"calc(100% * ".concat(c," + ").concat(l,"px)"),left:"calc(".concat(e," * ").concat(a," - ").concat(60/o*e,"px)"),"min-width":"60px","min-height":"17px"}},a.getEventTitle=function(){return(a.config.fields.find(function(t){return t.isEventTitle})||{}).property||"..."},a.getEventTime=function(t,e){return"".concat(moment(t).format("HH:mm")," - ").concat(moment(e).format("HH:mm"))},a.viewModes=["month","week"],a.viewMode=a.config.viewMode||a.viewModes[0],a.config.initialDate=a.config.initialDate?moment(a.config.initialDate).startOf("day"):moment().startOf("day"),a.config.timeslots=o(),r()}}}]);