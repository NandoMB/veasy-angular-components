"use strict";function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(e){_defineProperty(t,e,n[e])})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}angular.module("veasy.calendar").factory("calendarService",function(){var r=function(e){return e.format("MMMM YYYY")},a=function(e){var t=e.clone().startOf("week"),n=e.clone().endOf("week");return t.format("MMMM YYYY")===n.format("MMMM YYYY")?t.format("MMMM YYYY"):t.year()===n.year()?t.format("MMM")+" - "+n.format("MMM YYYY"):t.format("MMM YYYY")+" - "+n.format("MMM YYYY")},o=function(e,t,n,r){for(var a=t.clone().startOf("month"),o=[],i=1;i<=6;i++)o.push(c(e,a.clone(),n,r)),a.add(1,"weeks");return o},c=function(e,t,n,r){var a=[];t.day(0);for(var o=t.day();o<7;o++)a.push(i(e,t.clone(),n,r)),t.add(1,"days");return a},i=function(e,t,n,r){var a={date:t,year:t.format("YYYY"),month:t.format("MM"),day:t.format("DD"),isCurrentMonth:t.month()===r,isWeekend:0===t.day()||6===t.day(),isToday:t.startOf("day").isSame(moment().startOf("day"))};return"month"===e.viewMode?_objectSpread({},a,{events:u(t,n)}):"week"===e.viewMode?_objectSpread({},a,{multiDayEvents:f(e,n,t.year(),t.month(),t.date()),timeslots:d(e,t,n)}):void 0},u=function(e,t){var n=e.year(),r=e.month(),a=e.date();return t[n]&&t[n][r]?(t[n][r][a]||[]).sort(function(e,t){return moment(e.date).isSameOrBefore(t.date)?1:-1}):[]},f=function(e,t,n,r,a){return Object.keys(t).length?(t[n]=t[n]||{},t[n][r]=t[n][r]||{},t[n][r][a]=t[n][r][a]||{},t[n][r][a].multiDayEvents||[]):[]},d=function(e,t,n){for(var r=angular.copy(e.timeslots),a=0;a<e.timeslots.length;a++)r[a].events=l(t,r[a].time,n);return r},l=function(e,t,n){var r=e.year(),a=e.month(),o=e.date();return n[r]&&n[r][a]&&n[r][a][o]?(n[r][a][o][t]||[]).sort(function(e,t){return moment(e.date).isSameOrBefore(t.date)?1:-1}):[]};return{buildCalendar:function(e,t){e.viewMode=e.viewMode||"month";var n={viewMode:e.viewMode,initialDate:e.initialDate,weekDays:moment.weekdaysShort()};return"month"===e.viewMode?_objectSpread({},n,{title:r(e.initialDate),weeks:o(e,e.initialDate.clone(),t,e.initialDate.clone().month())}):"week"===e.viewMode?_objectSpread({},n,{title:a(e.initialDate),week:c(e,e.initialDate.clone(),t,e.initialDate.clone().month())}):void 0}}});
"use strict";function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(e){_defineProperty(t,e,r[e])})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}angular.module("veasy.calendar").factory("catalogService",function(){var l=function(){var e=Math.floor(256*Math.random()),t=Math.floor(256*Math.random()),r=Math.floor(256*Math.random()),n="#FFF";return 140<(299*e+587*t+114*r)/1e3&&(n="#333"),{background:"rgb(".concat(e,", ").concat(t,", ").concat(r,")"),text:n}},f=function(e,t,r,n,a,o){if(e[r]=e[r]||{},e[r][n]=e[r][n]||{},"month"===t)e[r][n][a]=e[r][n][a]||[];else if("week"===t&&(e[r][n][a]=e[r][n][a]||{},e[r][n][a].multiDayEvents=e[r][n][a].multiDayEvents||[],o))for(var i=0;i<o.length;i++){var u=o[i].time;e[r][n][a][u]=e[r][n][a][u]||[]}return e},d=function(e){return e.startDate.isSameOrBefore(e.endDate)},m=function(e){return!e.startDate.isSame(e.endDate,"day")},y=function(e,t){for(var r=t.startDate.clone();e[r.year()]=e[r.year()]||{},e[r.year()][r.month()]=e[r.year()][r.month()]||{},e[r.year()][r.month()][r.date()]=e[r.year()][r.month()][r.date()]||[],e[r.year()][r.month()][r.date()].push(t),r.add(1,"days"),r.isSameOrBefore(t.endDate););return e},v=function(e,t,r,n,a,o){for(var i=Math.ceil(r.endDate.diff(r.startDate,"hours")/24),u=0,c=r.startDate.clone(),s=e.initialDate.clone().startOf("week"),l=e.initialDate.clone().endOf("week");r=_objectSpread({},r,{chunk:u,payload:i,isCurrentWeek:c.isBetween(s,l,null,"[]")}),t=D(t,r,c.year(),c.month(),c.date()),c.add(1,"days"),u++,c.isSameOrBefore(r.endDate););return t},h=function(e,t,r,n,a,o){var i=o.find(function(e){return t.startDate.hour()===u(e)}).time;return e[r][n][a][i].push(t),e},u=function(e){return parseInt(e.time.substr(0,2))},D=function(e,t,r,n,a){return e[r]=e[r]||{},e[r][n]=e[r][n]||{},e[r][n][a]=e[r][n][a]||{},e[r][n][a].multiDayEvents=e[r][n][a].multiDayEvents||[],e[r][n][a].multiDayEvents.push(t),e};return{catalogEvents:function(e){var t=e.fields.find(function(e){return e.isEventOrigin}).property,r={},n=!0,a=!1,o=void 0;try{for(var i,u=e.events[Symbol.iterator]();!(n=(i=u.next()).done);n=!0){var c=i.value;c.veasyId=btoa(JSON.stringify(c)),c.colors=c.colors||{},e.randomEventsColors&&(c.colors=l());var s=moment(c[t]);c.startDate=moment(c.startDate),c.endDate=moment(c.endDate),r=f(r,e.viewMode,s.year(),s.month(),s.date(),e.timeslots),d(c)&&("month"===e.viewMode?r=y(r,c):"week"===e.viewMode&&(r=m(c)?(c.isMultiDayEvent=!0,v(e,r,c,s.year(),s.month(),s.date())):h(r,c,s.year(),s.month(),s.date(),e.timeslots)))}}catch(e){a=!0,o=e}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}return r}}});
"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}angular.module("veasy.calendar").directive("vCalendar",["$timeout","$filter","catalogService","calendarService",function(t,u,d,f){return{restrict:"E",replace:!0,templateUrl:"veasy-calendar.html",scope:{config:"<"},link:function(i,t,e,n){var o,a=function(){return[{time:"00:00",show:!1},{time:"01:00",show:!0},{time:"02:00",show:!0},{time:"03:00",show:!0},{time:"04:00",show:!0},{time:"05:00",show:!0},{time:"06:00",show:!0},{time:"07:00",show:!0},{time:"08:00",show:!0},{time:"09:00",show:!0},{time:"10:00",show:!0},{time:"11:00",show:!0},{time:"12:00",show:!0},{time:"13:00",show:!0},{time:"14:00",show:!0},{time:"15:00",show:!0},{time:"16:00",show:!0},{time:"17:00",show:!0},{time:"18:00",show:!0},{time:"19:00",show:!0},{time:"20:00",show:!0},{time:"21:00",show:!0},{time:"22:00",show:!0},{time:"23:00",show:!0}]},r=function(){i.$watchCollection("config.events",function(t,e){t.length&&(i.config.events=u("orderBy")(t,"startDate",!1),o=d.catalogEvents(i.config,t),c(i.config,o))})},c=function(t,e){i.calendar=f.buildCalendar(t,e),"week"===i.viewMode&&(i.weeklyEventsLines=m(i.calendar,e))};i.onClickDay=function(t,e){var n=e?e.time.split(":")[0]:0,o=e?e.time.split(":")[1]:0,a=t.date.clone().hour(n).minute(o);i.$emit("veasycalendar:onClickDay",a)},i.onClickEvent=function(t,e){t.stopPropagation();var n=angular.copy(e);n.$$hashKey&&delete n.$$hashKey,n.veasyId&&delete n.veasyId,n.colors&&delete n.colors,i.$emit("veasycalendar:onClickEvent",n)},i.onClickToday=function(){i.config.initialDate=moment(),c(i.config,o)},i.onChangeViewMode=function(t){i.config.viewMode=t,i.viewMode=t,i.config.initialDate=moment(),o=d.catalogEvents(i.config,i.config.events),c(i.config,o),i.$emit("veasycalendar:onChangeViewMode")},i.onPreviousMonth=function(){i.$emit("veasycalendar:onClickPreviousMonthStart"),i.config.initialDate=i.calendar.initialDate.subtract(1,"month"),c(i.config,o),i.$emit("veasycalendar:onClickPreviousMonthEnd")},i.onNextMonth=function(){i.$emit("veasycalendar:onClickNextMonthStart"),i.config.initialDate=i.calendar.initialDate.add(1,"month"),c(i.config,o),i.$emit("veasycalendar:onClickNextMonthEnd")},i.onPreviousWeek=function(){i.$emit("veasycalendar:onClickPreviousWeekStart"),i.config.initialDate=i.calendar.initialDate.subtract(1,"week"),c(i.config,o),i.$emit("veasycalendar:onClickPreviousWeekEnd")},i.onNextWeek=function(){i.$emit("veasycalendar:onClickNextWeekStart"),i.config.initialDate=i.calendar.initialDate.add(1,"week"),c(i.config,o),i.$emit("veasycalendar:onClickNextWeekEnd")};var l=function(){for(var t=[],e=0;e<7;e++)t.push({isEmpty:!0});return t},s=function(t,e){return t.reduce(function(t,e){return t.concat(e)},[]).some(function(t){return t.veasyId===e})},m=function(t){for(var e=function(t){for(var e=Math.max.apply(Math,_toConsumableArray(t.week.map(function(t){return t.multiDayEvents.length}))),n=[],o=0;o<e;o++)n.push(l());return n}(t),n=0;n<t.week.length;n++)for(var o=t.week[n],a=0;a<o.multiDayEvents.length;a++)for(var i=o.multiDayEvents[a],r=0;r<e.length;r++)if(e[r][n].isEmpty){if(s(e,i.veasyId))break;e[r][n]=i;for(var c=1;c<i.payload-i.chunk;c++)e[r][n+c]&&(e[r][n+c].isEmpty=!1);break}return e};i.getMonthlyEventStyle=function(t){return{color:t.colors.text,"background-color":t.colors.background,"border-color":t.colors.background}},i.getWeeklyEventStyle=function(t){var e=t.chunk,n=t.payload,o=n,a=moment(t.startDate).day();return 0<e&&(a=moment(t.startDate).add(e,"days").day()),0<e&&(t.isLeftArrow=!0,o=n-e),7<a+n-e&&(t.isRightArrow=!0,o=7-a),7<n+a&&1,{position:"absolute",left:"".concat(2,"px"),width:"calc(100% * ".concat(o," + ").concat(o-1,"px - ").concat(4,"px)"),color:t.colors.text,"background-color":t.colors.background,"border-color":t.colors.background,"z-index":2}},i.getEventStyle=function(t,e,n,o){var a=o.length-1||1,i="".concat(100/a,"%"),r=moment.duration(moment(t.endDate).diff(moment(t.startDate))),c=5*(Math.ceil(r.asMinutes()/60)-1),l=moment(t.endDate).diff(moment(t.startDate),"minutes");return{position:"absolute",left:"calc(".concat(e," * ").concat(i," - ").concat(60/a*e,"px)"),top:"".concat(100*t.startDate.minutes()/60,"%"),width:"calc(100% - ".concat(4,"px - (").concat(a," * ").concat(i,"))"),height:"calc(".concat(l/60*100,"% + ").concat(c,"px)"),"min-width":"60px","min-height":"17px",color:t.colors.text,"background-color":t.colors.background}},i.getEventTitle=function(){return(i.config.fields.find(function(t){return t.isEventTitle})||{}).property||"..."},i.getEventTime=function(t,e){return"".concat(moment(t).format("HH:mm")," - ").concat(moment(e).format("HH:mm"))},i.viewModes=["month","week"],i.viewMode=i.config.viewMode||i.viewModes[0],i.config.initialDate=i.config.initialDate?moment(i.config.initialDate).startOf("day"):moment().startOf("day"),i.config.timeslots=a(),r()}}}]);