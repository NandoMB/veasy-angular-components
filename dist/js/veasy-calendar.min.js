"use strict";angular.module("veasy.calendar").factory("vCalendarService",function(){var o=function(e,t){if("month"===t)return e.format("MMMM YYYY");var n=e.clone().startOf("week"),r=e.clone().endOf("week");return n.format("MMMM YYYY")===r.format("MMMM YYYY")?n.format("MMMM YYYY"):n.year()===r.year()?n.format("MMM")+" - "+r.format("MMM YYYY"):n.format("MMM YYYY")+" - "+r.format("MMM YYYY")},a=function(e,t,n,r){for(var o=[],a=t.clone().startOf("month"),s=1;s<=6;)o.push(m(e,a,n,r)),s++;return o},m=function(e,t,n,r){var o=[];t.day(0);for(var a=t.day();o.push(s(e,t.clone(),n,r)),t.add(1,"days"),++a<7;);return o},s=function(e,t,n,r){return{date:t,day:t.format("DD"),month:t.format("MM"),year:t.format("YYYY"),isCurrentMonth:t.month()===r,isWeekend:0===t.day()||6===t.day(),isToday:t.isSame(moment().startOf("day")),timeslots:i(t,n,e)}},i=function(e,t){return[{time:"00:00",events:n(e,"00:00",t),show:!1},{time:"01:00",events:n(e,"01:00",t),show:!0},{time:"02:00",events:n(e,"02:00",t),show:!0},{time:"03:00",events:n(e,"03:00",t),show:!0},{time:"04:00",events:n(e,"04:00",t),show:!0},{time:"05:00",events:n(e,"05:00",t),show:!0},{time:"06:00",events:n(e,"06:00",t),show:!0},{time:"07:00",events:n(e,"07:00",t),show:!0},{time:"08:00",events:n(e,"08:00",t),show:!0},{time:"09:00",events:n(e,"09:00",t),show:!0},{time:"10:00",events:n(e,"10:00",t),show:!0},{time:"11:00",events:n(e,"11:00",t),show:!0},{time:"12:00",events:n(e,"12:00",t),show:!0},{time:"13:00",events:n(e,"13:00",t),show:!0},{time:"14:00",events:n(e,"14:00",t),show:!0},{time:"15:00",events:n(e,"15:00",t),show:!0},{time:"16:00",events:n(e,"16:00",t),show:!0},{time:"17:00",events:n(e,"17:00",t),show:!0},{time:"18:00",events:n(e,"18:00",t),show:!0},{time:"19:00",events:n(e,"19:00",t),show:!0},{time:"20:00",events:n(e,"20:00",t),show:!0},{time:"21:00",events:n(e,"21:00",t),show:!0},{time:"22:00",events:n(e,"22:00",t),show:!0},{time:"23:00",events:n(e,"23:00",t),show:!0}]},n=function(e,t,n){var r=e.year(),o=e.month(),a=e.date();return n[r]&&n[r][o]&&n[r][o][a]?(n[r][o][a][t]||[]).sort(function(e,t){return moment(e.date).isSameOrBefore(t.date)?1:-1}):[]},w=function(e,t){var n=t.fields.filter(function(e){return"moment"===e.type||"date"===e.type}),r=!0,o=!1,a=void 0;try{for(var s,m=n[Symbol.iterator]();!(r=(s=m.next()).done);r=!0){var i=s.value;e[i.property]=moment(e[i.property])}}catch(e){o=!0,a=e}finally{try{r||null==m.return||m.return()}finally{if(o)throw a}}return e};return{buildCalendar:function(e,t){var n=e.initialDate?moment(e.initialDate).startOf("day"):moment().startOf("day"),r=e.viewMode||"month";return{date:n,viewMode:r,title:o(n,r),year:n.year(),month:n.month(),weekDays:moment.weekdaysShort(),weeks:a(e,n.clone(),t,n.clone().month()),week:m(e,n.clone(),t,n.clone().month()),events:t}},catalogEvents:function(e){var t=e.timeslots,n=e.events,r=e.fields.find(function(e){return e.isEventOrigin}),o={},a=!0,s=!1,m=void 0;try{for(var i,v=n[Symbol.iterator]();!(a=(i=v.next()).done);a=!0){var f=i.value,h=moment(f[r.property]).year(),u=moment(f[r.property]).month(),l=moment(f[r.property]).date();o[h]=o[h]||{},o[h][u]=o[h][u]||{},o[h][u][l]=o[h][u][l]||{};for(var y=0;y<t.length;y++){var d=t[y].time;o[h][u][l][d]=o[h][u][l][d]||[],moment(f.startDate).isSameOrBefore(f.endDate)&&(moment(f.startDate).isSame(f.endDate,"day")||(f.allDay=!0),moment(f.startDate).hour()===parseInt(d.substr(0,2))&&o[h][u][l][d].push(w(f,e)))}}}catch(e){s=!0,m=e}finally{try{a||null==v.return||v.return()}finally{if(s)throw m}}return o}}});
"use strict";function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),a.forEach(function(e){_defineProperty(t,e,n[e])})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}angular.module("veasy.calendar").directive("vCalendar",["$timeout","vCalendarService",function(e,c){return{restrict:"E",replace:!0,templateUrl:"veasy-calendar.html",scope:{config:"="},link:function(f,e,t,n){var a;f.changeViewMode=function(e){f.viewMode=e};var o=function(e){var t=e.reduce(function(e,t){return e.concat(f.getAllDayEvents(t))},[]);f.allDayEvents=t.map(function(e){var t=moment(f.calendar.week[0].date).startOf("day"),n=moment(f.calendar.week[f.calendar.week.length-1].date).endOf("day"),a=moment(e.endDate).isBetween(t,n)?moment(e.endDate).day():6;return _objectSpread({},e,{position:moment(e.startDate).day(),slots:a-moment(e.startDate).day()+1,duration:moment.duration(Math.ceil(moment(e.endDate).diff(moment(e.startDate),"hours")/24),"days").asDays()})});for(var n=f.allDayEvents.reduce(function(e,t){return e+t.duration},0),a=Math.ceil(n/7)||1,o=[],i=0;i<a;i++)o.push(Array(7));for(var r=0;r<f.allDayEvents.length;r++)for(var c=f.allDayEvents[r],l=0;l<o.length;l++){var s=o[l];if(!s[c.position]&&v(s,c)){for(var d=c.position+c.slots,m=c.position;m<d;m++)s[m]=m===c.position?c:{};break}}for(var u=0;u<o.length;u++){o[u].every(function(e){return null===e})&&1<o.length&&o.splice(u,1)}f.allDayEventsLines=o},v=function(e,t){for(var n=t.position+t.slots,a=!0,o=t.position;o<n;o++)e[o]&&(a=!1);return a},i=function(e){a=c.catalogEvents(e),f.calendar=c.buildCalendar(e,a),function(e,t){for(var n=moment(e.week[0].date).startOf("day"),a=moment(e.week[e.week.length-1].date).endOf("day"),o=0;o<t.length;o++){var i=t[o];i.startDate=moment(i.startDate),i.endDate=moment(i.endDate),i.startDate.isBetween(n,a)&&i.endDate.isBetween(n,a)&&console.log(i)}}(f.calendar,e.events),o(f.calendar.week)},r=function(){f.$watchCollection("config.events",function(e,t){f.config.events=e,i(f.config)})};f.getEventTitle=function(){return(f.config.fields.find(function(e){return e.isEventTitle})||{}).property||"..."},f.getEventTime=function(e,t){return"".concat(moment(e).format("HH:mm")," - ").concat(moment(t).format("HH:mm"))},f.previousMonth=function(){f.$emit("veasyCalendar:onClickPreviousMonthStart"),f.config.initialDate=f.calendar.date.subtract(1,"month"),f.calendar=c.buildCalendar(f.config,a),f.$emit("veasyCalendar:onClickPreviousMonthEnd")},f.nextMonth=function(){f.$emit("veasyCalendar:onClickNextMonthStart"),f.config.initialDate=f.calendar.date.add(1,"month"),f.calendar=c.buildCalendar(f.config,a),f.$emit("veasyCalendar:onClickNextMonthEnd")},f.previousWeek=function(){f.$emit("veasyCalendar:onClickPreviousWeekStart"),f.config.initialDate=f.calendar.date.subtract(1,"week"),f.calendar=c.buildCalendar(f.config,a),o(f.calendar.week),f.$emit("veasyCalendar:onClickPreviousWeekEnd")},f.nextWeek=function(){f.$emit("veasyCalendar:onClickNextWeekStart"),f.config.initialDate=f.calendar.date.add(1,"week"),f.calendar=c.buildCalendar(f.config,a),o(f.calendar.week),f.$emit("veasyCalendar:onClickNextWeekEnd")},f.isTheRightTimeslot=function(e,t){return e.startDate.hour()===parseInt(t.time.substr(0,2))},f.getEventStyle=function(e,t,n,a){var o=a.length-1,i="".concat(100/o,"%"),r=moment.duration(moment(e.endDate).diff(moment(e.startDate))).asMinutes()/60;return{position:"absolute","background-color":e.color,width:"calc(100% - ".concat(4,"px - (").concat(o," * ").concat(i,"))"),height:"calc((100% * ".concat(r,") - ").concat(4,"px)"),left:"calc(".concat(t," * ").concat(i," - ").concat(60/o*t,"px)"),"min-width":"60px","min-height":"17px"}},f.getAllDayEventStyle=function(e){var t=moment(e.endDate).diff(moment(e.startDate),"days"),n=(moment.duration(t,"days").asDays(),e.slots-1);return{position:"absolute",left:"".concat(2,"px"),width:"calc(100% * ".concat(e.slots," + ").concat(n,"px - ").concat(4,"px)"),"z-index":2}},f.getAllDayEvents=function(e){for(var t=[],n=0;n<e.timeslots.length;n++)for(var a=e.timeslots[n],o=0;o<a.events.length;o++){var i=a.events[o];i.allDay&&t.push(i)}return t.sort(function(e,t){return moment(e.date).isSameOrBefore(t.date)?1:-1})},f.onClickDay=function(e,t){f.$emit("veasyCalendar:onClickDay",t)},f.onClickEvent=function(e,t){e.stopPropagation(),f.$emit("veasyCalendar:onClickEvent",t)},f.viewModes=["month","week"],f.viewMode=f.config.viewMode||f.viewModes[0],f.openedEvent={},f.config.timeslots=[{time:"00:00",show:!1},{time:"01:00",show:!0},{time:"02:00",show:!0},{time:"03:00",show:!0},{time:"04:00",show:!0},{time:"05:00",show:!0},{time:"06:00",show:!0},{time:"07:00",show:!0},{time:"08:00",show:!0},{time:"09:00",show:!0},{time:"10:00",show:!0},{time:"11:00",show:!0},{time:"12:00",show:!0},{time:"13:00",show:!0},{time:"14:00",show:!0},{time:"15:00",show:!0},{time:"16:00",show:!0},{time:"17:00",show:!0},{time:"18:00",show:!0},{time:"19:00",show:!0},{time:"20:00",show:!0},{time:"21:00",show:!0},{time:"22:00",show:!0},{time:"23:00",show:!0}],i(f.config),r()}}}]);