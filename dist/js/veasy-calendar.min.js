"use strict";angular.module("veasy.calendar").factory("vCalendarService",function(){var a=function(t,e,r){for(var a=[],n=t.clone().startOf("month"),o=1;o<=6;)a.push(m(n,e,r)),o++;return a},m=function(t,e,r){var a=[];t.day(0);for(var n=t.day();a.push(o(t.clone(),e,r)),t.add(1,"days"),++n<7;);return a},o=function(t,e,r){return{date:t,day:t.format("DD"),month:t.format("MM"),year:t.format("YYYY"),events:n(t,e),isCurrentMonth:t.month()===r,isWeekend:0===t.day()||6===t.day(),isToday:t.isSame(moment().startOf("day"))}},n=function(t,e){var r=t.year(),a=t.month(),n=t.date();return e[r]&&e[r][a]?(e[r][a][n]||[]).sort(function(t,e){return moment(t.date).isSameOrBefore(e.date)?1:-1}):[]};return{buildCalendar:function(t,e){var r=t.date||moment().startOf("day");return{date:r,title:r.format("MMMM YYYY"),year:r.year(),month:r.month(),weekDays:moment.weekdaysShort(),weeks:a(r,e,r.clone().month()),events:e}},catalogEvents:function(t,e){var r={},a=!0,n=!1,o=void 0;try{for(var m,u=t[Symbol.iterator]();!(a=(m=u.next()).done);a=!0){var d=m.value,f=moment(d[e]).year(),y=moment(d[e]).month(),i=moment(d[e]).date();r[f]=r[f]||{},r[f][y]=r[f][y]||{},r[f][y][i]=r[f][y][i]||[],r[f][y][i].push(d)}}catch(t){n=!0,o=t}finally{try{a||null==u.return||u.return()}finally{if(n)throw o}}return r}}});
"use strict";angular.module("veasy.calendar").directive("vCalendar",["$timeout","vCalendarService",function(e,l){return{restrict:"E",replace:!0,templateUrl:"veasy-calendar.html",scope:{config:"="},link:function(a,e,n,t){var o,i=function(e){o=l.catalogEvents(e.events||[],e.bindableProperty),a.calendar=l.buildCalendar(e,o)},d=function(){a.$watchCollection("config.events",function(e,n){a.config.events=e,i(a.config)})};a.previousMonth=function(){a.$emit("veasyCalendar:onClickPreviousMonthStart"),a.config.date=a.calendar.date.subtract(1,"month"),a.calendar=l.buildCalendar(a.config,o),a.$emit("veasyCalendar:onClickPreviousMonthEnd")},a.nextMonth=function(){a.$emit("veasyCalendar:onClickNextMonthStart"),a.config.date=a.calendar.date.add(1,"month"),a.calendar=l.buildCalendar(a.config,o),a.$emit("veasyCalendar:onClickNextMonthEnd")},a.$on("veasyCalendar:addNewEvent",function(e,n){a.openedEvent={},r("event-modal",{keyboard:!0,backdrop:!0})}),a.onClickDay=function(e){a.$emit("veasyCalendar:onClickDay",{message:JSON.stringify(e)}),a.openedEvent={},r("event-modal",{keyboard:!0,backdrop:!0})},a.onClickEvent=function(e,n){e.stopPropagation(),a.$emit("veasyCalendar:onClickEvent",{message:JSON.stringify(n)}),a.openedEvent=angular.copy(n),r("event-modal",{keyboard:!0,backdrop:!0})},a.onSaveEvent=function(e){a.$emit("veasyCalendar:onSaveEvent",{message:JSON.stringify(e)}),a.openedEvent={},c("event-modal")};var r=function(e,n){angular.element("#"+e).modal({keyboard:n.keyboard,backdrop:n.backdrop})},c=function(e){angular.element("#"+e).modal("hide"),a.openedEvent={}};a.openedEvent={},i(a.config),d()}}}]);