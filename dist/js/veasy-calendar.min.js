"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}angular.module("veasy.calendar").directive("vCalendar",["$timeout","$filter","catalogService","calendarService",function(t,f,u,d){return{restrict:"E",replace:!0,templateUrl:"veasy-calendar.html",scope:{config:"<"},link:function(n,t,e,i){var o,a=function(){return[{time:"00:00",show:!1},{time:"01:00",show:!0},{time:"02:00",show:!0},{time:"03:00",show:!0},{time:"04:00",show:!0},{time:"05:00",show:!0},{time:"06:00",show:!0},{time:"07:00",show:!0},{time:"08:00",show:!0},{time:"09:00",show:!0},{time:"10:00",show:!0},{time:"11:00",show:!0},{time:"12:00",show:!0},{time:"13:00",show:!0},{time:"14:00",show:!0},{time:"15:00",show:!0},{time:"16:00",show:!0},{time:"17:00",show:!0},{time:"18:00",show:!0},{time:"19:00",show:!0},{time:"20:00",show:!0},{time:"21:00",show:!0},{time:"22:00",show:!0},{time:"23:00",show:!0}]},r=function(){n.$watchCollection("config.events",function(t,e){t.length&&(n.config.events=f("orderBy")(t,"startDate",!1),o=u.catalogEvents(n.config,t),c(n.config,o))})},c=function(t,e){n.calendar=d.buildCalendar(t,e),"week"===n.viewMode&&(n.weeklyEventsLines=m(n.calendar,e))};n.onClickToday=function(){n.config.initialDate=moment(),c(n.config,o)},n.onChangeViewMode=function(t){n.config.viewMode=t,n.viewMode=t,n.config.initialDate=moment(),o=u.catalogEvents(n.config,n.config.events),c(n.config,o),n.$emit("veasycalendar:onChangeViewMode")},n.onPreviousMonth=function(){n.$emit("veasycalendar:onClickPreviousMonthStart"),n.config.initialDate=n.calendar.initialDate.subtract(1,"month"),c(n.config,o),n.$emit("veasycalendar:onClickPreviousMonthEnd")},n.onNextMonth=function(){n.$emit("veasycalendar:onClickNextMonthStart"),n.config.initialDate=n.calendar.initialDate.add(1,"month"),c(n.config,o),n.$emit("veasycalendar:onClickNextMonthEnd")},n.onPreviousWeek=function(){n.$emit("veasycalendar:onClickPreviousWeekStart"),n.config.initialDate=n.calendar.initialDate.subtract(1,"week"),c(n.config,o),n.$emit("veasycalendar:onClickPreviousWeekEnd")},n.onNextWeek=function(){n.$emit("veasycalendar:onClickNextWeekStart"),n.config.initialDate=n.calendar.initialDate.add(1,"week"),c(n.config,o),n.$emit("veasycalendar:onClickNextWeekEnd")};var l=function(){for(var t=[],e=0;e<7;e++)t.push({isEmpty:!0});return t},s=function(t,e){return t.reduce(function(t,e){return t.concat(e)},[]).some(function(t){return t.id===e})},m=function(t){for(var e=function(t){for(var e=Math.max.apply(Math,_toConsumableArray(t.week.map(function(t){return t.multiDayEvents.length}))),n=[],i=0;i<e;i++)n.push(l());return n}(t),n=0;n<t.week.length;n++)for(var i=t.week[n],o=0;o<i.multiDayEvents.length;o++)for(var a=i.multiDayEvents[o],r=0;r<e.length;r++)if(e[r][n].isEmpty){if(s(e,a.id))break;e[r][n]=a;for(var c=1;c<a.payload-a.chunk;c++)e[r][n+c]&&(e[r][n+c].isEmpty=!1);break}return e};n.getWeeklyEventStyle=function(t){var e=t.chunk,n=t.payload,i=n,o=moment(t.startDate).day();return 0<e&&(o=moment(t.startDate).add(e,"days").day()),0<e&&(t.isLeftArrow=!0,i=n-e),7<o+n-e&&(t.isRightArrow=!0,i=7-o),7<n+o&&1,{position:"absolute",left:"".concat(2,"px"),width:"calc(100% * ".concat(i," + ").concat(i-1,"px - ").concat(4,"px)"),"z-index":2}},n.getEventStyle=function(t,e,n,i){var o=i.length-1||1,a="".concat(100/o,"%"),r=moment.duration(moment(t.endDate).diff(moment(t.startDate))),c=Math.ceil(r.asMinutes()/60),l=5*(c-1);return{position:"absolute","background-color":t.color,width:"calc(100% - ".concat(4,"px - (").concat(o," * ").concat(a,"))"),height:"calc(100% * ".concat(c," + ").concat(l,"px)"),left:"calc(".concat(e," * ").concat(a," - ").concat(60/o*e,"px)"),"min-width":"60px","min-height":"17px"}},n.getEventTitle=function(){return(n.config.fields.find(function(t){return t.isEventTitle})||{}).property||"..."},n.viewModes=["month","week"],n.viewMode=n.config.viewMode||n.viewModes[0],n.config.initialDate=n.config.initialDate?moment(n.config.initialDate).startOf("day"):moment().startOf("day"),n.config.timeslots=a(),r()}}}]);