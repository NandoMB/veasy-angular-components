"use strict";angular.module("veasy.calendar").factory("vCalendarService",function(){var n=function(t,e,r){for(var n=[],a=t.clone().startOf("month"),o=1;o<=6;)n.push(i(a,e,r)),o++;return n},i=function(t,e,r){var n=[];t.day(0);for(var a=t.day();n.push(o(t.clone(),e,r)),t.add(1,"days"),++a<7;);return n},o=function(t,e,r){return{date:t,day:t.format("DD"),month:t.format("MM"),year:t.format("YYYY"),events:a(t,e),isCurrentMonth:t.month()===r,isWeekend:0===t.day()||6===t.day(),isToday:t.isSame(moment().startOf("day"))}},a=function(t,e){var r=t.year(),n=t.month(),a=t.date();return e[r]&&e[r][n]?(e[r][n][a]||[]).sort(function(t,e){return moment(t.date).isSameOrBefore(e.date)?1:-1}):[]};return{buildCalendar:function(t,e){var r=t.initialDate?moment(t.initialDate).startOf("day"):moment().startOf("day");return{date:r,title:r.format("MMMM YYYY"),year:r.year(),month:r.month(),weekDays:moment.weekdaysShort(),weeks:n(r,e,r.clone().month()),events:e}},catalogEvents:function(t){var e=t.events,r=t.fields.find(function(t){return t.isEventOrigin}),n={},a=!0,o=!1,i=void 0;try{for(var m,u=e[Symbol.iterator]();!(a=(m=u.next()).done);a=!0){var d=m.value,f=moment(d[r.property]).year(),y=moment(d[r.property]).month(),s=moment(d[r.property]).date();n[f]=n[f]||{},n[f][y]=n[f][y]||{},n[f][y][s]=n[f][y][s]||[],n[f][y][s].push(d)}}catch(t){o=!0,i=t}finally{try{a||null==u.return||u.return()}finally{if(o)throw i}}return n}}});
"use strict";angular.module("veasy.calendar").directive("vCalendar",["$timeout","vCalendarService",function(n,c){return{restrict:"E",replace:!0,templateUrl:"veasy-calendar.html",scope:{config:"="},link:function(a,n,e,t){var o,i=function(n){o=c.catalogEvents(n),a.calendar=c.buildCalendar(n,o)},d=function(){a.$watchCollection("config.events",function(n,e){a.config.events=n,i(a.config)})};a.getEventTitle=function(){return(a.config.fields.find(function(n){return n.isEventTitle})||{}).property||"..."},a.previousMonth=function(){a.$emit("veasyCalendar:onClickPreviousMonthStart"),a.config.initialDate=a.calendar.date.subtract(1,"month"),a.calendar=c.buildCalendar(a.config,o),a.$emit("veasyCalendar:onClickPreviousMonthEnd")},a.nextMonth=function(){a.$emit("veasyCalendar:onClickNextMonthStart"),a.config.initialDate=a.calendar.date.add(1,"month"),a.calendar=c.buildCalendar(a.config,o),a.$emit("veasyCalendar:onClickNextMonthEnd")},a.$on("veasyCalendar:addNewEvent",function(n,e){a.openedEvent={},r("event-modal",{keyboard:!0,backdrop:!0})}),a.onClickDay=function(n){a.$emit("veasyCalendar:onClickDay",n),a.openedEvent={},r("event-modal",{keyboard:!0,backdrop:!0})},a.onClickEvent=function(n,e){n.stopPropagation(),a.$emit("veasyCalendar:onClickEvent",e),a.openedEvent=angular.copy(e),r("event-modal",{keyboard:!0,backdrop:!0})},a.onSaveEvent=function(n){a.$emit("veasyCalendar:onSaveEvent",n),a.openedEvent={},l("event-modal")};var r=function(n,e){angular.element("#"+n).modal({keyboard:e.keyboard,backdrop:e.backdrop})},l=function(n){angular.element("#"+n).modal("hide"),a.openedEvent={}};a.openedEvent={},i(a.config),d()}}}]);