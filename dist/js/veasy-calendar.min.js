"use strict";angular.module("veasy.calendar").factory("vCalendarService",function(){var a=function(t,e){if("month"===e)return t.format("MMMM YYYY");var r=t.clone().startOf("week"),n=t.clone().endOf("week");return r.format("MMMM YYYY")===n.format("MMMM YYYY")?r.format("MMMM YYYY"):r.year()===n.year()?r.format("MMM")+" - "+n.format("MMM YYYY"):r.format("MMM YYYY")+" - "+n.format("MMM YYYY")},o=function(t,e,r){for(var n=[],a=t.clone().startOf("month"),o=1;o<=6;)n.push(i(a,e,r)),o++;return n},i=function(t,e,r){var n=[];t.day(0);for(var a=t.day();n.push(m(t.clone(),e,r)),t.add(1,"days"),++a<7;);return n},m=function(t,e,r){return{date:t,day:t.format("DD"),month:t.format("MM"),year:t.format("YYYY"),events:n(t,e),isCurrentMonth:t.month()===r,isWeekend:0===t.day()||6===t.day(),isToday:t.isSame(moment().startOf("day"))}},n=function(t,e){var r=t.year(),n=t.month(),a=t.date();return e[r]&&e[r][n]?(e[r][n][a]||[]).sort(function(t,e){return moment(t.date).isSameOrBefore(e.date)?1:-1}):[]},M=function(t,e){var r=e.fields.filter(function(t){return"moment"===t.type||"date"===t.type}),n=!0,a=!1,o=void 0;try{for(var i,m=r[Symbol.iterator]();!(n=(i=m.next()).done);n=!0){var f=i.value;t[f.property]=moment(t[f.property])}}catch(t){a=!0,o=t}finally{try{n||null==m.return||m.return()}finally{if(a)throw o}}return t};return{buildCalendar:function(t,e){var r=t.initialDate?moment(t.initialDate).startOf("day"):moment().startOf("day"),n=t.viewMode||"month";return{date:r,viewMode:n,title:a(r,n),year:r.year(),month:r.month(),weekDays:moment.weekdaysShort(),weeks:o(r.clone(),e,r.clone().month()),week:i(r.clone(),e,r.clone().month()),events:e}},catalogEvents:function(t){var e=t.events,r=t.fields.find(function(t){return t.isEventOrigin}),n={},a=!0,o=!1,i=void 0;try{for(var m,f=e[Symbol.iterator]();!(a=(m=f.next()).done);a=!0){var u=m.value,y=moment(u[r.property]).year(),l=moment(u[r.property]).month(),d=moment(u[r.property]).date();n[y]=n[y]||{},n[y][l]=n[y][l]||{},n[y][l][d]=n[y][l][d]||[],n[y][l][d].push(M(u,t))}}catch(t){o=!0,i=t}finally{try{a||null==f.return||f.return()}finally{if(o)throw i}}return n}}});
"use strict";angular.module("veasy.calendar").directive("vCalendar",["$timeout","vCalendarService",function(e,r){return{restrict:"E",replace:!0,templateUrl:"veasy-calendar.html",scope:{config:"="},link:function(n,e,t,i){var a,o=function(e){a=r.catalogEvents(e),n.calendar=r.buildCalendar(e,a)},c=function(){n.$watchCollection("config.events",function(e,t){n.config.events=e,o(n.config)})};n.getEventTitle=function(){return(n.config.fields.find(function(e){return e.isEventTitle})||{}).property||"..."},n.getEventTime=function(e,t){var n="HH:mm";return"".concat(moment(e).format(n)," - ").concat(moment(t).format(n))},n.previousMonth=function(){n.$emit("veasyCalendar:onClickPreviousMonthStart"),n.config.initialDate=n.calendar.date.subtract(1,"month"),n.calendar=r.buildCalendar(n.config,a),n.$emit("veasyCalendar:onClickPreviousMonthEnd")},n.nextMonth=function(){n.$emit("veasyCalendar:onClickNextMonthStart"),n.config.initialDate=n.calendar.date.add(1,"month"),n.calendar=r.buildCalendar(n.config,a),n.$emit("veasyCalendar:onClickNextMonthEnd")},n.previousWeek=function(){n.$emit("veasyCalendar:onClickPreviousWeekStart"),n.config.initialDate=n.calendar.date.subtract(1,"week"),n.calendar=r.buildCalendar(n.config,a),n.$emit("veasyCalendar:onClickPreviousWeekEnd")},n.nextWeek=function(){n.$emit("veasyCalendar:onClickNextWeekStart"),n.config.initialDate=n.calendar.date.add(1,"week"),n.calendar=r.buildCalendar(n.config,a),n.$emit("veasyCalendar:onClickNextWeekEnd")},n.isTheRightTimeslot=function(e,t){return e.startDate.hour()===parseInt(t.time.substr(0,2))},n.getEventStyle=function(e,t,n){var i=n.length-1,a="".concat(100/i,"%"),o=moment.duration(moment(e.endDate).diff(moment(e.startDate))).asMinutes()/60;return{"background-color":e.color,width:"calc(100% - ".concat(4,"px - (").concat(i," * ").concat(a,"))"),height:"calc((100% * ".concat(o,") - ").concat(4,"px)"),left:"calc(".concat(t," * ").concat(a," - ").concat(60/i*t,"px)"),"min-width":"60px"}},n.onClickDay=function(e,t){n.$emit("veasyCalendar:onClickDay",t)},n.onClickEvent=function(e,t){e.stopPropagation(),n.$emit("veasyCalendar:onClickEvent",t)},n.viewMode=n.config.viewMode||"month",n.openedEvent={},n.timeslots=[{time:"00:00",show:!1},{time:"01:00",show:!0},{time:"02:00",show:!0},{time:"03:00",show:!0},{time:"04:00",show:!0},{time:"05:00",show:!0},{time:"06:00",show:!0},{time:"07:00",show:!0},{time:"08:00",show:!0},{time:"09:00",show:!0},{time:"10:00",show:!0},{time:"11:00",show:!0},{time:"12:00",show:!0},{time:"13:00",show:!0},{time:"14:00",show:!0},{time:"15:00",show:!0},{time:"16:00",show:!0},{time:"17:00",show:!0},{time:"18:00",show:!0},{time:"19:00",show:!0},{time:"20:00",show:!0},{time:"21:00",show:!0},{time:"22:00",show:!0},{time:"23:00",show:!0}],o(n.config),c()}}}]);