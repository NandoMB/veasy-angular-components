"use strict";angular.module("veasy.calendar").factory("vCalendarService",function(){var n=function(t,r,e){for(var n=[],a=t.clone().startOf("month"),o=1;o<=6;)n.push(i(a,r,e)),o++;return n},i=function(t,r,e){var n=[];t.day(0);for(var a=t.day();n.push(o(t.clone(),r,e)),t.add(1,"days"),++a<7;);return n},o=function(t,r,e){return{date:t,day:t.format("DD"),month:t.format("MM"),year:t.format("YYYY"),events:a(t,r),isCurrentMonth:t.month()===e,isWeekend:0===t.day()||6===t.day(),isToday:t.isSame(moment().startOf("day"))}},a=function(t,r){var e=t.year(),n=t.month(),a=t.date();return r[e]&&r[e][n]?(r[e][n][a]||[]).sort(function(t,r){return moment(t.date).isSameOrBefore(r.date)?1:-1}):[]},s=function(t,r){var e=r.fields.filter(function(t){return"moment"===t.type||"date"===t.type}),n=!0,a=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done);n=!0){var m=i.value;t[m.property]=moment(t[m.property])}}catch(t){a=!0,o=t}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}return t};return{buildCalendar:function(t,r){var e=t.initialDate?moment(t.initialDate).startOf("day"):moment().startOf("day");return{date:e,title:e.format("MMMM YYYY"),year:e.year(),month:e.month(),weekDays:moment.weekdaysShort(),weeks:n(e,r,e.clone().month()),events:r}},catalogEvents:function(t){var r=t.events,e=t.fields.find(function(t){return t.isEventOrigin}),n={},a=!0,o=!1,i=void 0;try{for(var u,m=r[Symbol.iterator]();!(a=(u=m.next()).done);a=!0){var y=u.value,f=moment(y[e.property]).year(),d=moment(y[e.property]).month(),l=moment(y[e.property]).date();n[f]=n[f]||{},n[f][d]=n[f][d]||{},n[f][d][l]=n[f][d][l]||[],n[f][d][l].push(s(y,t))}}catch(t){o=!0,i=t}finally{try{a||null==m.return||m.return()}finally{if(o)throw i}}return n}}});
"use strict";angular.module("veasy.calendar").directive("vCalendar",["$timeout","vCalendarService",function(n,c){return{restrict:"E",replace:!0,templateUrl:"veasy-calendar.html",scope:{config:"="},link:function(a,n,e,t){var o,i=function(n){o=c.catalogEvents(n),a.calendar=c.buildCalendar(n,o)},d=function(){a.$watchCollection("config.events",function(n,e){a.config.events=n,i(a.config)})};a.getEventTitle=function(){return(a.config.fields.find(function(n){return n.isEventTitle})||{}).property||"..."},a.previousMonth=function(){a.$emit("veasyCalendar:onClickPreviousMonthStart"),a.config.initialDate=a.calendar.date.subtract(1,"month"),a.calendar=c.buildCalendar(a.config,o),a.$emit("veasyCalendar:onClickPreviousMonthEnd")},a.nextMonth=function(){a.$emit("veasyCalendar:onClickNextMonthStart"),a.config.initialDate=a.calendar.date.add(1,"month"),a.calendar=c.buildCalendar(a.config,o),a.$emit("veasyCalendar:onClickNextMonthEnd")},a.$on("veasyCalendar:addNewEvent",function(n,e){a.openedEvent={},r("event-modal",{keyboard:!0,backdrop:!0})}),a.onClickDay=function(n){a.$emit("veasyCalendar:onClickDay",n),a.openedEvent={},r("event-modal",{keyboard:!0,backdrop:!0})},a.onClickEvent=function(n,e){n.stopPropagation(),a.$emit("veasyCalendar:onClickEvent",e),a.openedEvent=angular.copy(e),r("event-modal",{keyboard:!0,backdrop:!0})},a.onSaveEvent=function(n){a.$emit("veasyCalendar:onSaveEvent",n),a.openedEvent={},l("event-modal")};var r=function(n,e){angular.element("#"+n).modal({keyboard:e.keyboard,backdrop:e.backdrop})},l=function(n){angular.element("#"+n).modal("hide"),a.openedEvent={}};a.openedEvent={},i(a.config),d()}}}]);