"use strict";angular.module("veasy.calendar").factory("vCalendarService",function(){var o=function(e,t){if("month"===t)return e.format("MMMM YYYY");var n=e.clone().startOf("week"),r=e.clone().endOf("week");return n.format("MMMM YYYY")===r.format("MMMM YYYY")?n.format("MMMM YYYY"):n.year()===r.year()?n.format("MMM")+" - "+r.format("MMM YYYY"):n.format("MMM YYYY")+" - "+r.format("MMM YYYY")},a=function(e,t,n,r){for(var o=[],a=t.clone().startOf("month"),s=1;s<=6;)o.push(m(e,a,n,r)),s++;return o},m=function(e,t,n,r){var o=[];t.day(0);for(var a=t.day();o.push(s(e,t.clone(),n,r)),t.add(1,"days"),++a<7;);return o},s=function(e,t,n,r){return{date:t,day:t.format("DD"),month:t.format("MM"),year:t.format("YYYY"),events:v(t,n),isCurrentMonth:t.month()===r,isWeekend:0===t.day()||6===t.day(),isToday:t.isSame(moment().startOf("day")),timeslots:i(t,n,e)}},i=function(e,t){return[{time:"00:00",events:n(e,"00:00",t),show:!1},{time:"01:00",events:n(e,"01:00",t),show:!0},{time:"02:00",events:n(e,"02:00",t),show:!0},{time:"03:00",events:n(e,"03:00",t),show:!0},{time:"04:00",events:n(e,"04:00",t),show:!0},{time:"05:00",events:n(e,"05:00",t),show:!0},{time:"06:00",events:n(e,"06:00",t),show:!0},{time:"07:00",events:n(e,"07:00",t),show:!0},{time:"08:00",events:n(e,"08:00",t),show:!0},{time:"09:00",events:n(e,"09:00",t),show:!0},{time:"10:00",events:n(e,"10:00",t),show:!0},{time:"11:00",events:n(e,"11:00",t),show:!0},{time:"12:00",events:n(e,"12:00",t),show:!0},{time:"13:00",events:n(e,"13:00",t),show:!0},{time:"14:00",events:n(e,"14:00",t),show:!0},{time:"15:00",events:n(e,"15:00",t),show:!0},{time:"16:00",events:n(e,"16:00",t),show:!0},{time:"17:00",events:n(e,"17:00",t),show:!0},{time:"18:00",events:n(e,"18:00",t),show:!0},{time:"19:00",events:n(e,"19:00",t),show:!0},{time:"20:00",events:n(e,"20:00",t),show:!0},{time:"21:00",events:n(e,"21:00",t),show:!0},{time:"22:00",events:n(e,"22:00",t),show:!0},{time:"23:00",events:n(e,"23:00",t),show:!0}]},n=function(e,t,n){var r=e.year(),o=e.month(),a=e.date();return n[r]&&n[r][o]&&n[r][o][a]?(n[r][o][a][t]||[]).sort(function(e,t){return moment(e.date).isSameOrBefore(t.date)?1:-1}):[]},v=function(e,t){var n=e.year(),r=e.month(),o=e.date();return t[n]&&t[n][r]&&t[n][r][o]&&t[n][r][o].events?t[n][r][o].events.sort(function(e,t){return moment(e.date).isSameOrBefore(t.date)?1:-1}):[]},w=function(e,t){var n=t.fields.filter(function(e){return"moment"===e.type||"date"===e.type}),r=!0,o=!1,a=void 0;try{for(var s,m=n[Symbol.iterator]();!(r=(s=m.next()).done);r=!0){var i=s.value;e[i.property]=moment(e[i.property])}}catch(e){o=!0,a=e}finally{try{r||null==m.return||m.return()}finally{if(o)throw a}}return e};return{buildCalendar:function(e,t){var n=e.initialDate?moment(e.initialDate).startOf("day"):moment().startOf("day"),r=e.viewMode||"month";return{date:n,viewMode:r,title:o(n,r),year:n.year(),month:n.month(),weekDays:moment.weekdaysShort(),weeks:a(e,n.clone(),t,n.clone().month()),week:m(e,n.clone(),t,n.clone().month()),events:t}},catalogEvents:function(e){var t=e.timeslots,n=e.events,r=e.fields.find(function(e){return e.isEventOrigin}),o={},a=!0,s=!1,m=void 0;try{for(var i,v=n[Symbol.iterator]();!(a=(i=v.next()).done);a=!0){var f=i.value,u=moment(f[r.property]).year(),h=moment(f[r.property]).month(),d=moment(f[r.property]).date();o[u]=o[u]||{},o[u][h]=o[u][h]||{},o[u][h][d]=o[u][h][d]||{};for(var l=0;l<t.length;l++){var y=t[l].time;o[u][h][d][y]=o[u][h][d][y]||[],moment(f.startDate).isSameOrBefore(f.endDate)&&(moment(f.startDate).isSame(f.endDate,"day")||(f.allDay=!0),moment(f.startDate).hour()===parseInt(y.substr(0,2))&&o[u][h][d][y].push(w(f,e)))}}}catch(e){s=!0,m=e}finally{try{a||null==v.return||v.return()}finally{if(s)throw m}}return o}}});
"use strict";angular.module("veasy.calendar").directive("vCalendar",["$timeout","vCalendarService",function(e,r){return{restrict:"E",replace:!0,templateUrl:"veasy-calendar.html",scope:{config:"="},link:function(n,e,t,a){var i,o=function(e){i=r.catalogEvents(e),n.calendar=r.buildCalendar(e,i)},c=function(){n.$watchCollection("config.events",function(e,t){n.config.events=e,o(n.config)})};n.getEventTitle=function(){return(n.config.fields.find(function(e){return e.isEventTitle})||{}).property||"..."},n.getEventTime=function(e,t){var n="HH:mm";return"".concat(moment(e).format(n)," - ").concat(moment(t).format(n))},n.previousMonth=function(){n.$emit("veasyCalendar:onClickPreviousMonthStart"),n.config.initialDate=n.calendar.date.subtract(1,"month"),n.calendar=r.buildCalendar(n.config,i),n.$emit("veasyCalendar:onClickPreviousMonthEnd")},n.nextMonth=function(){n.$emit("veasyCalendar:onClickNextMonthStart"),n.config.initialDate=n.calendar.date.add(1,"month"),n.calendar=r.buildCalendar(n.config,i),n.$emit("veasyCalendar:onClickNextMonthEnd")},n.previousWeek=function(){n.$emit("veasyCalendar:onClickPreviousWeekStart"),n.config.initialDate=n.calendar.date.subtract(1,"week"),n.calendar=r.buildCalendar(n.config,i),n.$emit("veasyCalendar:onClickPreviousWeekEnd")},n.nextWeek=function(){n.$emit("veasyCalendar:onClickNextWeekStart"),n.config.initialDate=n.calendar.date.add(1,"week"),n.calendar=r.buildCalendar(n.config,i),n.$emit("veasyCalendar:onClickNextWeekEnd")},n.isTheRightTimeslot=function(e,t){return e.startDate.hour()===parseInt(t.time.substr(0,2))},n.getEventStyle=function(e,t,n,a){var i=a.length-1,o="".concat(100/i,"%"),c=moment.duration(moment(e.endDate).diff(moment(e.startDate))).asMinutes()/60;return{position:"absolute","background-color":e.color,width:"calc(100% - ".concat(4,"px - (").concat(i," * ").concat(o,"))"),height:"calc((100% * ".concat(c,") - ").concat(4,"px)"),left:"calc(".concat(t," * ").concat(o," - ").concat(60/i*t,"px)"),"min-width":"60px","min-height":"17px"}},n.getAllDayEventStyle=function(e){var t=moment(e.endDate).diff(moment(e.startDate),"days"),n=moment.duration(t,"days").asDays();return{position:"relative",width:"calc(".concat(300,"% + (10px * ",n,"))"),"z-index":2}},n.getAllDayEvents=function(e){for(var t=[],n=0;n<e.timeslots.length;n++)for(var a=e.timeslots[n],i=0;i<a.events.length;i++){var o=a.events[i];o.allDay&&t.push(o)}return t},n.onClickDay=function(e,t){n.$emit("veasyCalendar:onClickDay",t)},n.onClickEvent=function(e,t){e.stopPropagation(),n.$emit("veasyCalendar:onClickEvent",t)},n.viewMode=n.config.viewMode||"month",n.openedEvent={},n.config.timeslots=[{time:"00:00",show:!1},{time:"01:00",show:!0},{time:"02:00",show:!0},{time:"03:00",show:!0},{time:"04:00",show:!0},{time:"05:00",show:!0},{time:"06:00",show:!0},{time:"07:00",show:!0},{time:"08:00",show:!0},{time:"09:00",show:!0},{time:"10:00",show:!0},{time:"11:00",show:!0},{time:"12:00",show:!0},{time:"13:00",show:!0},{time:"14:00",show:!0},{time:"15:00",show:!0},{time:"16:00",show:!0},{time:"17:00",show:!0},{time:"18:00",show:!0},{time:"19:00",show:!0},{time:"20:00",show:!0},{time:"21:00",show:!0},{time:"22:00",show:!0},{time:"23:00",show:!0}],o(n.config),c()}}}]);